<window
    xmlns="http://www.haulmont.com/schema/cuba/gui/window.xsd"
    datasource="role"
    caption="msg://caption"
    class="com.haulmont.cuba.web.app.ui.security.role.edit.RoleEditor"
>
    <metadataContext>
        <deployViews name="/com/haulmont/cuba/web/app/ui/security/user/user.views.xml"/>
        <deployViews name="/com/haulmont/cuba/web/app/ui/security/group/group.views.xml"/>
    </metadataContext>

    <dsContext>
        <datasource
            id="role"
            class="com.haulmont.cuba.security.entity.Role"
            view="role.edit"
        >
            <collectionDatasource id="permissions" property="permissions"/>
        </datasource>

        <hierarchicalDatasource
            id="entities"
            class="com.haulmont.cuba.gui.config.PermissionConfig$Target"
            view="role.edit"
        >
            <datasourceClass>com.haulmont.cuba.gui.security.EntityPermissionTargetsDatasource</datasourceClass>
        </hierarchicalDatasource>

        <collectionDatasource
            id="entityPermissions"
            class="com.haulmont.cuba.gui.config.PermissionConfig$Target"
            view="role.edit"
        >
            <datasourceClass>com.haulmont.cuba.gui.data.CustomCollectionDatasource</datasourceClass>
            <query>
                <![CDATA[
                import com.haulmont.cuba.gui.AppConfig
                
                config = AppConfig.getInstance().getPermissionConfig()
                return config.getEntityOperations(:ds$entities);
                ]]>
            </query>
        </collectionDatasource>

        <hierarchicalDatasource
            id="screenPermissions"
            class="com.haulmont.cuba.gui.config.PermissionConfig$Target"
            view="role.edit"
        >
            <datasourceClass>com.haulmont.cuba.gui.security.ScreenPermissionTargetsDatasource</datasourceClass>
        </hierarchicalDatasource>

        <hierarchicalDatasource
            id="specificPermissions"
            class="com.haulmont.cuba.gui.config.PermissionConfig$Target"
            view="role.edit"
        >
            <datasourceClass>com.haulmont.cuba.gui.security.SpecificPermissionTargetsDatasource</datasourceClass>
        </hierarchicalDatasource>
    </dsContext>

    <layout expand="permissions-pane">
        <hbox spacing="true">
            <label value="msg://name"/>
            <textField id="name" datasource="role" property="name"/>

            <label value="msg://superRole"/>
            <checkBox id="superRole" datasource="role" property="superRole"/>
        </hbox>
        <hbox></hbox>
        <vbox id="permissions-pane" expand="roles" spacing="true">
            <tabsheet id="permissions-types">
                <tab id="entity-permissions-tab" caption="msg://entity-permissions">
                    <split orientation="horizontal" pos="30">
                        <tree id="entity-permissions-tree">
                            <treechildren datasource="entities" captionProperty="caption"/>
                        </tree>
                        <vbox>
                            <optionsGroup
                                id="entity-permissions"
                                optionsDatasource="entityPermissions"
                                multiselect="true"
                                captionProperty="caption"
                            />
                        </vbox>
                    </split>
                </tab>
                <tab id="screen-permissions-tab" caption="msg://screen-permissions">
                    <tree id="screen-permissions-tree">
                         <treechildren datasource="screenPermissions" captionProperty="caption"/>
                    </tree>
                </tab>
                <tab id="specific-permissions-tab" caption="msg://specific-permissions">
                    <tree id="specific-permissions-tree">
                          <treechildren datasource="specificPermissions" captionProperty="caption"/>
                     </tree>
                </tab>
            </tabsheet>
        </vbox>
    </layout>
</window>
