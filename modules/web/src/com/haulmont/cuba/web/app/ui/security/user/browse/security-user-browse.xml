<window
    class="com.haulmont.cuba.web.app.ui.security.user.browse.SecurityUserBrowser"
    lookupComponent="users"
>
    <metadataContext>
        <deployViews name="/com/haulmont/cuba/web/app/ui/security/user/browse/security-user-browse.views.xml"/>
    </metadataContext>

    <dsContext>
        <collection-datasource
            id="users"
            class="com.haulmont.cuba.security.entity.User"
            view="browse"
        >
            <query>
                <![CDATA[select u from sec$User u where <#if component$filter.name?has_content>u.name like :component$filter.name<#else>1=1</#if>]]>
            </query>
        </collection-datasource>

        <collection-datasource
            id="profiles"
            class="com.haulmont.cuba.security.entity.Profile"
            view="browse"
        >
            <query>select p from sec$Profile p where p.user.id = :ds$users</query>
        </collection-datasource>
    </dsContext>

    <layout>
        <vbox expand="table-panel">
            <iframe id="filter" src="/com/haulmont/cuba/web/app/ui/security/user/browse/security-user-browse-filter.xml"/>
            <hbox id="table-panel" expand="table">
                <split orientation="horizontal">
                    <vbox expand="users">
                        <hbox>
                            <button action="users.edit"/>
                        </hbox>
                        <table id="users">
                            <columns>
                                <column id="name" label="Name"/>
                            </columns>
                            <rows datasource="users"/>
                        </table>
                    </vbox>
                    <vbox expand="profiles">
                        <table id="profiles">
                            <columns>
                                <column id="name" label="Name"/>
                                <column id="defaultProfile" label="Default"/>
                            </columns>
                            <rows datasource="profiles"/>
                        </table>
                    </vbox>
                </split>
            </hbox>
        </vbox>
    </layout>
</window>
