/*
 * Copyright (c) 2008-2016 Haulmont.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 */

$cuba-table-header-row-height-scale: 1.5 !default;

@mixin flat-table($primary-stylename: v-table) {
  .#{$primary-stylename} {
    @include cuba-flat-table-style();
  }

  .c-table-contextmenu {
    @include cuba-flat-selection-overlay-style($item-stylename: c-table-contextmenu-item);
  }

  &.small {
    .#{$primary-stylename} {
      @include cuba-flat-table-size-style($primary-stylename: $primary-stylename, $row-height: $v-table-row-height--small, $font-size: $v-font-size--small, $header-font-size: $v-table-header-font-size--small);
    }

    .c-table-contextmenu {
      @include cuba-flat-selection-overlay-size-style($item-height: $v-selection-item-height--large, $font-size: $v-font-size--large, $item-stylename: c-table-contextmenu-item);
    }
  }

  &.large {
    .#{$primary-stylename} {
      @include cuba-flat-table-size-style($primary-stylename: $primary-stylename, $row-height: $v-table-row-height--large, $font-size: $v-font-size--large, $header-font-size: $v-table-header-font-size--large);
    }

    .c-table-contextmenu {
      @include cuba-flat-selection-overlay-size-style($item-height: $v-selection-item-height--large, $font-size: $v-font-size--large, $item-stylename: c-table-contextmenu-item);
    }
  }
}

@mixin cuba-flat-table-style($primary-stylename: v-table) {
  @include cuba-flat-table-size-style($primary-stylename: $primary-stylename);

  $table-inner-border: flat-border($color: --read-only-border-color, $strength: $v-table-border-width);
  $table-outer-border: flat-border($color: --border-color, $strength: $v-table-border-width);

  // TODO: gg, replace?
  $background-color: $v-table-background-color or valo-table-background-color();

  color: var(--text-medium-color);
  background: $background-color;

  .#{$primary-stylename}-header table,
  .#{$primary-stylename}-footer table,
  .#{$primary-stylename}-table {
    -webkit-box-shadow: 0 0 0 $v-table-border-width var(--read-only-border-color);
    box-shadow: 0 0 0 $v-table-border-width var(--read-only-border-color);
  }

  .#{$primary-stylename}-body {
    border: $table-inner-border;
    border-left-color: var(--border-color);
    border-right-color: var(--border-color);

    @if $v-table-border-radius > 0 {
      border-radius: 0 0 $v-table-border-radius $v-table-border-radius;
    }
    border-bottom-color: var(--border-color);
  }

  &.has-footer .#{$primary-stylename}-body {
    border-radius: 0;
    border-bottom-color: var(--read-only-border-color);
  }

  .#{$primary-stylename}-header-wrap,
  .#{$primary-stylename}-footer-wrap,
  .#{$primary-stylename}-header-drag {
    border: $table-outer-border;
    background: $background-color;
    color: var(--text-color);
  }

  .#{$primary-stylename}-row-odd {
    background-color: var(--read-only-color);
  }

  .#{$primary-stylename}-header-wrap {
    border-bottom: $table-inner-border;

    @if $v-table-border-radius > 0 {
      overflow: hidden;
    }
  }

  .#{$primary-stylename}-footer-wrap {
    border-top: $table-inner-border;
  }

  .#{$primary-stylename}-caption-container,
  .#{$primary-stylename}-header-drag,
  .#{$primary-stylename}-cell-content {
    border-left: $table-inner-border;
  }

  .#{$primary-stylename}-cell-content:first-child {
    border-left: none;
  }

  .#{$primary-stylename}-header td:first-child .#{$primary-stylename}-caption-container,
  .#{$primary-stylename}-footer td:first-child {
    border-left-color: transparent;
  }

  .#{$primary-stylename}-table td {
    border-top: $table-inner-border;
  }

  [class*="-row"].v-selected {
    background: var(--primary-color);
    color: var(--primary-text-color);
    text-shadow: none;

    + .v-selected {
      background: var(--primary-color);

      td {
        border-top-color: var(--primary-color);
      }
    }

    .#{$primary-stylename}-cell-content {
      border-left-color: var(--primary-hover-color);
    }
  }

  .#{$primary-stylename}-focus {
    outline-color: var(--primary-color);
  }

  @if $cuba-table-highlight-hover-row {
    .#{$primary-stylename}-row:hover,
    .#{$primary-stylename}-row-odd:hover {
      background-color: var(--primary-disabled-color);
      color: var(--text-medium-color);

      .#{$primary-stylename}-cell-content.boolean-cell-true .#{$primary-stylename}-cell-wrapper,
      .#{$primary-stylename}-cell-content.boolean-cell-false .#{$primary-stylename}-cell-wrapper {
        &:before {
          color: var(--text-medium-color);
        }
      }
    }

    .#{$primary-stylename}-row.v-selected:hover,
    .#{$primary-stylename}-row-odd.v-selected:hover {
      background: var(--primary-color);
      color: var(--primary-text-color);

      .#{$primary-stylename}-cell-content.boolean-cell-true .#{$primary-stylename}-cell-wrapper,
      .#{$primary-stylename}-cell-content.boolean-cell-false .#{$primary-stylename}-cell-wrapper {
        &:before {
          color: var(--primary-text-color);
        }
      }
    }
  }

  .#{$primary-stylename}-arow {
    background: $cuba-table-aggregation-background-color;
    border-top: $table-inner-border;
    border-left: $table-outer-border;
    border-right: $table-outer-border;
  }

  .#{$primary-stylename}-arow-row {
    border-right: $table-inner-border;
    color: var(--text-color);
  }

  .#{$primary-stylename}-footer td {
    border-left: $table-inner-border;
  }

  .#{$primary-stylename}-footer-wrap {
    background: $cuba-table-aggregation-background-color;
  }

  .#{$primary-stylename}-focus-slot-left,
  .#{$primary-stylename}-focus-slot-right {
    border-color: var(--primary-color);
  }

  .#{$primary-stylename}-cell-content.boolean-cell-true .#{$primary-stylename}-cell-wrapper,
  .#{$primary-stylename}-cell-content.boolean-cell-false .#{$primary-stylename}-cell-wrapper {
    &:before {
      color: var(--text-medium-color);
    }
  }

  .v-selected {
    .#{$primary-stylename}-cell-content.boolean-cell-true .#{$primary-stylename}-cell-wrapper,
    .#{$primary-stylename}-cell-content.boolean-cell-false .#{$primary-stylename}-cell-wrapper {
      &:before {
        color: var(--primary-text-color);
      }
    }
  }

  .#{$primary-stylename}-row-drag-bottom td.#{$primary-stylename}-cell-content {
    border-bottom: flat-border($strength: 2px);
  }

  .#{$primary-stylename}-row-drag-top td.#{$primary-stylename}-cell-content {
    border-top: flat-border($strength: 2px);
  }

  .#{$primary-stylename}-column-selector {
    @include cuba-flat-control-button-style()
  }

  .c-table-prefs-icon {
    @include cuba-flat-control-button-style()
  }

  // TODO: gg, possibly move to halo
  //  as it can be a proper fix if $v-table-cell-padding-horizontal has value other than 7px
  .c-grouptable-group-divider .#{$primary-stylename}-cell-wrapper,
  .#{$primary-stylename}-cell-content-c-grouptable-group-divider .#{$primary-stylename}-cell-wrapper,
  .c-grouptable-group-divider-header .#{$primary-stylename}-caption-container,
  .c-grouptable-group-divider-footer .#{$primary-stylename}-footer-container {
    padding: 0;
  }
}

@mixin cuba-flat-table-size-style($primary-stylename: v-table,
                                  $row-height: $v-table-row-height,
                                  $font-size: $v-font-size,
                                  $header-font-size: $v-table-header-font-size) {
  $table-header-row-height: round($row-height * $cuba-table-header-row-height-scale);

  .#{$primary-stylename}-header-wrap,
  .#{$primary-stylename}-footer-wrap,
  .#{$primary-stylename}-header-drag {
    font-size: $header-font-size;
  }

  .#{$primary-stylename}-header-wrap .#{$primary-stylename}-caption-container {
    min-height: $table-header-row-height;
  }

  .#{$primary-stylename}-footer-container {
    min-height: $row-height;
    $vertical-padding: round(($row-height - $header-font-size)/2);
    padding: $vertical-padding - $v-table-border-width $v-table-cell-padding-horizontal $vertical-padding;
  }

  .c-grouptable-group-divider-footer .#{$primary-stylename}-footer-container {
    padding: 0;
  }

  .#{$primary-stylename}-header-drag,
  .#{$primary-stylename}-header-wrap .#{$primary-stylename}-caption-container {
    $vertical-padding: round(($table-header-row-height - $header-font-size)/2);
    padding: $vertical-padding $v-table-cell-padding-horizontal $vertical-padding - $v-table-border-width;
  }

  .#{$primary-stylename}-resizer {
    height: $table-header-row-height;
  }

  .#{$primary-stylename}-cell-content {
    font-size: $font-size;
    height: $row-height;
  }

  .#{$primary-stylename}-header-cell.#{$primary-stylename}-header-sortable,
  .#{$primary-stylename}-header-cell-asc,
  .#{$primary-stylename}-header-cell-desc {
    .#{$primary-stylename}-sort-indicator {
      height: $table-header-row-height;
      line-height: $table-header-row-height;
    }
  }

  .#{$primary-stylename}-row-drag-bottom td.#{$primary-stylename}-cell-content {
    height: $row-height - 2px;
  }

  .#{$primary-stylename}-row-drag-top td.#{$primary-stylename}-cell-content {
    height: $row-height - 2px + $v-table-border-width;
  }

  .#{$primary-stylename}-column-selector {
    @include cuba-flat-control-button-size-style($table-header-row-height)
  }

  .c-table-prefs-icon {
    @include cuba-flat-control-button-size-style($table-header-row-height)
  }

  &.collapsing-allowed .c-table-prefs-icon {
    right: 2 * round($table-header-row-height/2);
  }

  .#{$primary-stylename}-cell-content.boolean-cell-true .#{$primary-stylename}-cell-wrapper,
  .#{$primary-stylename}-cell-content.boolean-cell-false .#{$primary-stylename}-cell-wrapper {
    &:before {
      font-size: $font-size;
    }
  }

  &.v-treetable {
    @include cuba-flat-treetable-size-style($primary-stylename: v-treetable, $row-height: $row-height, $font-size: $font-size, $header-font-size: $header-font-size);
  }
}

@mixin cuba-flat-treetable-size-style($primary-stylename: v-treetable,
                                      $row-height: $v-table-row-height,
                                      $font-size: $v-font-size,
                                      $header-font-size: $v-table-header-font-size) {
  $table-header-row-height: round($row-height * $cuba-table-header-row-height-scale);

  [class*="caption-container"],
  [class*="footer-container"],
  [class*="cell-wrapper"] {
    padding-left: 0;
    padding-right: 0;
  }

  [class*="caption-container"],
  [class*="footer-container"] {
    $vertical-padding: round(($table-header-row-height - $header-font-size)/2);
    min-height: $table-header-row-height - $vertical-padding - ($vertical-padding - $v-table-border-width);
  }

  [class*="cell-wrapper"] {
    min-height: $font-size;
  }

  [class*="caption-container"] {
    padding-left: $v-table-cell-padding-horizontal;
  }

  [class*="caption-container-align-right"] {
    padding-left: $v-table-cell-padding-horizontal + $v-table-resizer-width;
  }

  [class*="footer-container"] {
    padding-right: $v-table-cell-padding-horizontal;
  }

  [class*="cell-content"] {
    padding-left: $v-table-cell-padding-horizontal;
    padding-right: $v-table-cell-padding-horizontal;

    &:first-child {
      padding-left: $v-table-cell-padding-horizontal + $v-table-border-width;
    }
  }

  .#{$primary-stylename}-treespacer {
    width: round($row-height/2) !important;
    margin-left: round($row-height/-2) - round($v-table-cell-padding-horizontal/2);
  }
}

@mixin cuba-flat-control-button-style() {
  @include cuba-flat-button-default-style();
  @include cuba-flat-button-borderless-style($active-color: --primary-active-color);

  border: 0;
}

@mixin cuba-flat-control-button-size-style($row-height) {
  top: round($row-height/2) - round($row-height/4);
  right: round($row-height/2) - round($row-height/4);
  height: round($row-height/2);
  line-height: round($row-height/2);
  width: round($row-height/2);

  font-size: round($row-height/3);
}